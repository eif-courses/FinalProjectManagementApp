{{define "base"}}
<!DOCTYPE html>
<html lang="{{.Lang}}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{block "title" .}}{{.Title}}{{end}} - Baigiamųjų darbų valdymo sistema</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <!-- Alpine.js -->
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Custom styles -->
    <style>
        [x-cloak] { display: none !important; }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Print styles */
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
        }
        .print-only { display: none; }
    </style>

    {{block "head" .}}{{end}}
</head>
<body class="bg-gray-50 font-sans text-gray-900">
<!-- Navigation -->
<nav class="bg-white shadow-sm border-b border-gray-200 no-print">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
            <div class="flex items-center">
                <img src="/static/img/viko-logo.png" alt="VIKO" class="h-10 mr-3">
                <div>
                    <h1 class="text-lg font-semibold text-gray-800">{{.T "common.thesis_management_system"}}</h1>
                    <p class="text-xs text-gray-500">{{.T "institution.name"}}</p>
                </div>
            </div>

            {{if .User}}
            <div class="flex items-center space-x-4">
                <!-- Language Switcher -->
                <div class="relative" x-data="{ open: false }">
                    <button @click="open = !open" class="flex items-center text-sm text-gray-600 hover:text-gray-900">
                        <i class="fas fa-globe mr-1"></i>
                        {{if eq .Lang "lt"}}LT{{else}}EN{{end}}
                        <i class="fas fa-chevron-down ml-1 text-xs"></i>
                    </button>
                    <div x-show="open" @click.away="open = false" x-cloak
                         class="origin-top-right absolute right-0 mt-2 w-20 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5">
                        <a href="?lang=lt" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 {{if eq .Lang "lt"}}bg-gray-50{{end}}">LT</a>
                        <a href="?lang=en" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 {{if eq .Lang "en"}}bg-gray-50{{end}}">EN</a>
                    </div>
                </div>

                <!-- Notifications -->
                <button class="text-gray-500 hover:text-gray-700 relative">
                    <i class="fas fa-bell"></i>
                    <span class="absolute -top-1 -right-1 h-2 w-2 bg-red-500 rounded-full"></span>
                </button>

                <!-- User Menu -->
                <div class="relative" x-data="{ open: false }">
                    <button @click="open = !open" class="flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        <img class="h-8 w-8 rounded-full" src="https://ui-avatars.com/api/?name={{.User.Name}}&background=4F46E5&color=fff" alt="{{.User.Name}}">
                        <span class="ml-2 text-gray-700">{{.User.Name}}</span>
                        <i class="fas fa-chevron-down ml-1 text-xs text-gray-500"></i>
                    </button>

                    <div x-show="open" @click.away="open = false" x-cloak
                         class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5">
                        <div class="px-4 py-3 border-b">
                            <p class="text-sm text-gray-900">{{.User.Name}}</p>
                            <p class="text-xs text-gray-500">{{.User.Email}}</p>
                            <p class="text-xs text-gray-500 mt-1">{{.T (printf "user_roles.%s" .User.Role)}}</p>
                        </div>
                        <a href="/profile" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <i class="fas fa-user-circle mr-2"></i>{{.T "navigation.profile"}}
                        </a>
                        <a href="/settings" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                            <i class="fas fa-cog mr-2"></i>{{.T "navigation.settings"}}
                        </a>
                        <div class="border-t">
                            <a href="/auth/logout" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-sign-out-alt mr-2"></i>{{.T "navigation.logout"}}
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {{end}}
        </div>
    </div>
</nav>

<!-- Breadcrumbs (optional) -->
{{if .Breadcrumbs}}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2 no-print">
    <nav class="text-sm">
        <ol class="list-none p-0 inline-flex">
            {{range $i, $crumb := .Breadcrumbs}}
            {{if $i}}<li class="flex items-center mx-2 text-gray-400">/</li>{{end}}
            <li class="flex items-center">
                {{if $crumb.URL}}
                <a href="{{$crumb.URL}}" class="text-blue-600 hover:text-blue-800">{{$crumb.Title}}</a>
                {{else}}
                <span class="text-gray-600">{{$crumb.Title}}</span>
                {{end}}
            </li>
            {{end}}
        </ol>
    </nav>
</div>
{{end}}

<!-- Main Content -->
<main>
    {{block "content" .}}{{end}}
</main>

<!-- Footer -->
<footer class="bg-white border-t border-gray-200 mt-auto no-print">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <div class="text-center text-sm text-gray-500">
            © {{.CurrentYear}} {{.T "institution.name"}}. {{.T "common.all_rights_reserved"}}
        </div>
    </div>
</footer>

<!-- Global Scripts -->
<script>
    // HTMX Configuration
    document.body.addEventListener('htmx:configRequest', (event) => {
        event.detail.headers['X-Requested-With'] = 'XMLHttpRequest';
    });

    // Global error handler
    document.body.addEventListener('htmx:responseError', (event) => {
        console.error('HTMX Error:', event.detail);
        // Show error notification
        showNotification('error', '{{.T "errors.request_failed"}}');
    });

    // Notification function
    function showNotification(type, message) {
        // Implementation depends on your notification library
        console.log(`${type}: ${message}`);
    }

    // Copy to clipboard
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            showNotification('success', '{{.T "common.copied_to_clipboard"}}');
        });
    }
</script>

{{block "scripts" .}}{{end}}
</body>
</html>
{{end}}