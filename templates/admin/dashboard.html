package handlers

import (
"fmt"
"html/template"
"log"
"net/http"

"github.com/jmoiron/sqlx"

"FinalProjectManagementApp/auth"
"FinalProjectManagementApp/i18n"
)

type AdminHandler struct {
db        *sqlx.DB
templates *template.Template
localizer *i18n.Localizer
}

func NewAdminHandler(db *sqlx.DB, localizer *i18n.Localizer) *AdminHandler {
return &AdminHandler{
db:        db,
localizer: localizer,
}
}

func (h *AdminHandler) DashboardHandler(w http.ResponseWriter, r *http.Request) {
user := auth.GetUserFromContext(r.Context())
if user == nil {
log.Println("No user in admin dashboard handler")
http.Redirect(w, r, "/auth/login", http.StatusFound)
return
}

log.Printf("Admin dashboard accessed by %s", user.Email)

// For now, just return a simple HTML response to test
w.Header().Set("Content-Type", "text/html; charset=utf-8")
html := fmt.Sprintf(`<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
<div class="container mx-auto p-8">
    <h1 class="text-3xl font-bold mb-4">Admin Dashboard</h1>
    <p class="mb-4">Welcome, %s (%s)</p>
    <div class="bg-white rounded shadow p-6">
        <h2 class="text-xl font-semibold mb-2">Quick Stats</h2>
        <p>This is a temporary admin dashboard.</p>
        <p class="mt-4">
            <a href="/auth/logout" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Logout</a>
        </p>
    </div>
</div>
</body>
</html>`, user.Name, user.Email)

w.Write([]byte(html))
}

// Add stub methods for other handlers
func (h *AdminHandler) StudentsHandler(w http.ResponseWriter, r *http.Request) {
w.Write([]byte("Students page"))
}

func (h *AdminHandler) StudentsSearchHandler(w http.ResponseWriter, r *http.Request) {
w.Write([]byte("Students search"))
}

func (h *AdminHandler) StudentsTableHandler(w http.ResponseWriter, r *http.Request) {
w.Write([]byte("Students table"))
}

func (h *AdminHandler) TopicsHandler(w http.ResponseWriter, r *http.Request) {
w.Write([]byte("Topics page"))
}

func (h *AdminHandler) TopicsTableHandler(w http.ResponseWriter, r *http.Request) {
w.Write([]byte("Topics table"))
}

func (h *AdminHandler) ApproveTopicHandler(w http.ResponseWriter, r *http.Request) {
w.Write([]byte("Approve topic"))
}

func (h *AdminHandler) ReportsHandler(w http.ResponseWriter, r *http.Request) {
w.Write([]byte("Reports page"))
}

func (h *AdminHandler) CommissionTableHandler(w http.ResponseWriter, r *http.Request) {
w.Write([]byte("Commission table"))
}

func (h *AdminHandler) CreateCommissionModalHandler(w http.ResponseWriter, r *http.Request) {
w.Write([]byte("Create commission modal"))
}